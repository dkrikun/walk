#!/bin/bash

image=${2%.docker}
dockerfile=Dockerfile.$image

dependent_image() {
  cat $dockerfile | ruby -e 'if match = STDIN.read.match(/FROM walk\/(.*)/); puts match[1] + ".docker" end'
}

deps() {
  echo $dockerfile
  # If the image depends on another image being built here, add it to the list of dependencies.
  dependent_image
}

build() {
  exec docker build -t walk/$image -f Dockerfile.$image .
}

case $1 in
  deps) deps ;;
  exec) build ;;
esac
